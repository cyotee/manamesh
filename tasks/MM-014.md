# Task MM-014: Clear Timeout Timers on Success

**Repo:** ManaMesh
**Status:** Ready
**Created:** 2026-01-21
**Dependencies:** None
**Worktree:** `feature/fix-timeout-cleanup`
**Origin:** Code review finding from MM-006

---

## Description

Fix timeout timers created for helia init and helia fetch that aren't cleared on success. The `setTimeout` inside `Promise.race` pattern can cause late rejections and wasted timers when the main operation succeeds before timeout.

(Created from code review of MM-006 - Medium severity finding)

## Dependencies

- None (MM-006 is complete)

## User Stories

### US-MM-014.1: Clean Timer Handling

As a developer, I want timeout timers to be properly cleaned up so that there are no late rejections or resource leaks.

**Acceptance Criteria:**
- [ ] Timeout timers are cleared when operation succeeds
- [ ] No late promise rejections after successful fetch
- [ ] No memory leaks from dangling timers
- [ ] Tests verify timer cleanup
- [ ] Tests pass
- [ ] Build succeeds

## Technical Notes

Current pattern:
```typescript
Promise.race([
  actualOperation(),
  new Promise((_, reject) => setTimeout(() => reject(new Error('timeout')), ms))
])
```

Should use:
```typescript
const timer = setTimeout(...)
try {
  const result = await actualOperation()
  clearTimeout(timer)
  return result
} catch (e) {
  clearTimeout(timer)
  throw e
}
```

## Files to Create/Modify

**Modified Files:**
- `packages/frontend/src/assets/ipfs-loader.ts`

## Inventory Check

Before starting, verify:
- [ ] File exists: `packages/frontend/src/assets/ipfs-loader.ts`
- [ ] Identify all setTimeout/Promise.race patterns

## Completion Criteria

- [ ] All acceptance criteria met
- [ ] No dangling timers
- [ ] Tests pass
- [ ] Build succeeds

---

**When complete, output:** `<promise>TASK_COMPLETE</promise>`

**If blocked, output:** `<promise>TASK_BLOCKED: [reason]</promise>`
