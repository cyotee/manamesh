# Task MM-004: mDNS Local Discovery

**Repo:** ManaMesh
**Status:** Ready
**Created:** 2026-01-20
**Dependencies:** MM-002
**Worktree:** `feature/mdns-discovery`

---

## Description

Implement mDNS (multicast DNS) discovery for automatic peer detection on local networks. This enables zero-configuration LAN play for development and LAN parties.

## Dependencies

- MM-002: WebRTC + Two-Way Join Codes (must be complete)

## User Stories

### US-MM-004.1: Auto-Discover LAN Games

As a player on a local network, I want to automatically see available games so that I can join without entering any codes.

**Acceptance Criteria:**
- [ ] Discover peers on same LAN via mDNS
- [ ] List discovered games in lobby
- [ ] One-click join for LAN games
- [ ] Auto-refresh as peers come/go

### US-MM-004.2: Host LAN Game

As a host, I want to broadcast my game on the local network so that nearby players can find it automatically.

**Acceptance Criteria:**
- [ ] "Host LAN Game" option in lobby
- [ ] Broadcast game availability via mDNS
- [ ] Show connected player count
- [ ] Stop broadcast when game starts

## Technical Details

### mDNS via libp2p
- Use libp2p mDNS module for service discovery
- Broadcast on `_manamesh._tcp.local`
- Include peer ID and game metadata in TXT records

### Discovery Module (`discovery/mdns.ts`)
- Start/stop mDNS discovery
- Event emitter for peer found/lost
- Filter for ManaMesh peers only

### Browser Limitations
- mDNS requires libp2p with proper transport
- May need WebSocket fallback for some browsers
- Works best in Electron/PWA context

## Files to Create/Modify

**New Files:**
- `packages/frontend/src/p2p/discovery/mdns.ts` - mDNS discovery module

**Modified Files:**
- `packages/frontend/src/p2p/index.ts` - Export mDNS module
- `packages/frontend/src/components/P2PLobby.tsx` - Add LAN discovery UI

**Tests:**
- `packages/frontend/src/p2p/discovery/mdns.test.ts` - mDNS tests (mock)

## Inventory Check

Before starting, verify:
- [ ] MM-002 complete (WebRTC layer working)
- [ ] libp2p mDNS module available
- [ ] Test environment has LAN access

## Completion Criteria

- [ ] All acceptance criteria met
- [ ] Two devices on same LAN can discover each other
- [ ] LAN games appear in lobby
- [ ] Graceful fallback when mDNS unavailable
- [ ] Tests pass
- [ ] Build succeeds

---

**When complete, output:** `<promise>TASK_COMPLETE</promise>`

**If blocked, output:** `<promise>TASK_BLOCKED: [reason]</promise>`
