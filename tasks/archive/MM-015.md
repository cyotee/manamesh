# Task MM-015: Fix IPFS Loader Config and Gateway Priority

**Repo:** ManaMesh
**Status:** Ready
**Created:** 2026-01-21
**Dependencies:** None
**Worktree:** `feature/fix-ipfs-config`
**Origin:** Code review finding from MM-006

---

## Description

Fix two related configuration issues in the IPFS loader:

1. **Timeout config mismatch:** Config includes `heliaFetchTimeout` but `loadAsset` routes a single `timeout` value to both helia and gateway (defaulting to `gatewayTimeout`). Helia should use `heliaFetchTimeout`.

2. **Wrong gateway priority:** `preferGateway={true}` in GameBoard means gateway is tried first, which is the inverse of the helia-first requirement described in MM-006 (helia with gateway fallback).

(Created from code review of MM-006 - Medium severity findings)

## Dependencies

- None (MM-006 is complete)

## User Stories

### US-MM-015.1: Correct Timeout Configuration

As a developer, I want timeout configs to be used correctly so that helia and gateway have appropriate timeouts.

**Acceptance Criteria:**
- [ ] `heliaFetchTimeout` is used for helia operations
- [ ] `gatewayTimeout` is used for gateway operations
- [ ] Config values are properly passed through
- [ ] Tests verify correct timeout usage

### US-MM-015.2: Helia-First Loading

As a player, I want assets to load from local helia first so that I benefit from P2P distribution.

**Acceptance Criteria:**
- [ ] GameBoard uses `preferGateway={false}` (helia-first)
- [ ] Gateway is only used as fallback
- [ ] Loading behavior matches MM-006 spec
- [ ] Tests pass
- [ ] Build succeeds

## Files to Create/Modify

**Modified Files:**
- `packages/frontend/src/assets/ipfs-loader.ts` (timeout config)
- `packages/frontend/src/components/GameBoard.tsx` (preferGateway)

## Inventory Check

Before starting, verify:
- [ ] File exists: `packages/frontend/src/assets/config.ts`
- [ ] Understand heliaFetchTimeout vs gatewayTimeout

## Completion Criteria

- [ ] All acceptance criteria met
- [ ] Timeouts configured correctly
- [ ] Helia-first loading order
- [ ] Tests pass
- [ ] Build succeeds

---

**When complete, output:** `<promise>TASK_COMPLETE</promise>`

**If blocked, output:** `<promise>TASK_BLOCKED: [reason]</promise>`
