# Task MM-010: Fix Public Game Key Encoding

**Repo:** ManaMesh
**Status:** Ready
**Created:** 2026-01-21
**Dependencies:** MM-003
**Worktree:** `feature/fix-dht-key-encoding`
**Origin:** Code review suggestion from MM-003

---

## Description

Fix incorrect DHT key construction for public games. The current implementation interpolates a `Uint8Array` into a string, which produces a comma-separated list of byte values instead of the intended topic string. This causes public game keys to be unpredictable and unmatchable.

(Created from code review of MM-003 - Suggestion 2)

## Dependencies

- MM-003: libp2p DHT Discovery (parent task)

## Bug Details

Current code in `addToPublicGames()`:
```typescript
new TextEncoder().encode(`${getPublicGamesKey()}/${roomCode}`)
```

Problem: `getPublicGamesKey()` returns a `Uint8Array`. Interpolating it into a string produces garbage like `"18,144,221,45,7,234/${roomCode}"` instead of a proper key.

## User Stories

### US-MM-010.1: Correct DHT Key Generation

As a developer, I want public game keys to be correctly encoded so that games can be discovered reliably.

**Acceptance Criteria:**
- [ ] Public game keys use string topic constant, not Uint8Array interpolation
- [ ] Create helper like `getPublicGameKey(roomCode): Uint8Array` that correctly encodes
- [ ] Existing room code discovery still works
- [ ] Tests validate key format
- [ ] Tests pass
- [ ] Build succeeds

## Files to Create/Modify

**Modified Files:**
- `packages/frontend/src/p2p/discovery/dht.ts`
- `packages/frontend/src/p2p/libp2p-config.ts`

## Inventory Check

Before starting, verify:
- [ ] MM-003 implementation is available
- [ ] Understand current key encoding approach

## Completion Criteria

- [ ] All acceptance criteria met
- [ ] DHT keys are correctly formatted
- [ ] Tests pass
- [ ] Build succeeds

---

**When complete, output:** `<promise>TASK_COMPLETE</promise>`

**If blocked, output:** `<promise>TASK_BLOCKED: [reason]</promise>`
