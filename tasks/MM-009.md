# Task MM-009: Implement Public Game Indexing Mechanism

**Repo:** ManaMesh
**Status:** Ready
**Created:** 2026-01-21
**Dependencies:** MM-003
**Worktree:** `feature/public-game-indexing`
**Origin:** Code review suggestion from MM-003

---

## Description

Replace the placeholder "closest peers" scan with a deterministic read model for public game discovery. The current implementation creates an empty games array and never populates it, failing US-MM-003.3 acceptance criteria.

(Created from code review of MM-003 - Suggestion 1)

## Dependencies

- MM-003: libp2p DHT Discovery (parent task)

## User Stories

### US-MM-009.1: Public Game Discovery

As a player, I want to browse available public games so that I can join without a room code.

**Acceptance Criteria:**
- [ ] Public game records are stored in DHT under deterministic keys
- [ ] `fetchPublicGames()` actually retrieves and returns game records
- [ ] Game list shows host name and game type
- [ ] One-click join works for listed games
- [ ] Auto-refresh populates the list (not just refreshes empty)
- [ ] Tests pass
- [ ] Build succeeds

## Technical Options (pick one)

1. **Index key approach:** Publish each public game under `${PUBLIC_GAMES_TOPIC}/${roomCode}` and maintain a separate "index" key with recent room codes
2. **Single key approach:** Store full list under `${PUBLIC_GAMES_TOPIC}` (requires conflict handling)
3. **PubSub approach:** Shift public games discovery to PubSub instead of DHT

## Files to Create/Modify

**Modified Files:**
- `packages/frontend/src/p2p/discovery/dht.ts`
- `packages/frontend/src/p2p/libp2p-config.ts`

## Inventory Check

Before starting, verify:
- [ ] MM-003 implementation is available
- [ ] libp2p DHT is working for room code discovery

## Completion Criteria

- [ ] All acceptance criteria met
- [ ] Public game list actually shows games
- [ ] Tests pass
- [ ] Build succeeds

---

**When complete, output:** `<promise>TASK_COMPLETE</promise>`

**If blocked, output:** `<promise>TASK_BLOCKED: [reason]</promise>`
